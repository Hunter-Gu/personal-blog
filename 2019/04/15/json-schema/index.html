<!-- build time:Thu Aug 10 2023 18:07:33 GMT+0800 (China Standard Time) --><!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="在开发管理系统时, 我们几乎一直在编写 input, upload, select 等表单组件, 虽然有 ElementUI 等组件库提供了方便, 但是仍旧需要编写模板, 然后就需要测试, 这是一个死循环。但是这些表单组件实际上使用的逻辑和方法都很相似, 重复的编写和测试让人厌烦, 于是我就想能否将表单的结构通过 json 进行表示, 然后根据 json 结构渲染出组件树, 并且可以结合 Elem"><meta name="keywords" content="vue"><meta property="og:type" content="article"><meta property="og:title" content="实现一个 Vue json-form"><meta property="og:url" content="https://hunter-gu.github.io/personal-blog/2019/04/15/json-schema/index.html"><meta property="og:site_name" content="Nail&#39;s Blog"><meta property="og:description" content="在开发管理系统时, 我们几乎一直在编写 input, upload, select 等表单组件, 虽然有 ElementUI 等组件库提供了方便, 但是仍旧需要编写模板, 然后就需要测试, 这是一个死循环。但是这些表单组件实际上使用的逻辑和方法都很相似, 重复的编写和测试让人厌烦, 于是我就想能否将表单的结构通过 json 进行表示, 然后根据 json 结构渲染出组件树, 并且可以结合 Elem"><meta property="og:locale" content="default"><meta property="og:updated_time" content="2023-03-05T07:09:36.653Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="实现一个 Vue json-form"><meta name="twitter:description" content="在开发管理系统时, 我们几乎一直在编写 input, upload, select 等表单组件, 虽然有 ElementUI 等组件库提供了方便, 但是仍旧需要编写模板, 然后就需要测试, 这是一个死循环。但是这些表单组件实际上使用的逻辑和方法都很相似, 重复的编写和测试让人厌烦, 于是我就想能否将表单的结构通过 json 进行表示, 然后根据 json 结构渲染出组件树, 并且可以结合 Elem"><link rel="shortcut icon" href="/personal-blog/images/favicon.ico"><link rel="icon" type="image/png" href="/personal-blog/images/favicon-192x192.png" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/personal-blog/images/apple-touch-icon.png"><title>实现一个 Vue json-form</title><link rel="stylesheet" href="/personal-blog/css/style.css"><link rel="stylesheet" href="/personal-blog/css/rtl.css"></head><body class="max-width mx-auto px3 ltr"><div id="header-post"><a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")' style="display:none"><i class="fas fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/personal-blog/">Home</a></li><li><a href="/personal-blog/archives/">Writing</a></li><li><a href="/personal-blog/about/">About</a></li><li><a href="/personal-blog/tags/">Tag</a></li><li><a href="/personal-blog/categories/">categories</a></li><li><a href="/personal-blog/inspiration/">inspiration</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="/personal-blog/2019/06/01/cc-builder/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class="icon" href="/personal-blog/2019/04/11/javascript-async/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class="icon" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")'><i class="fas fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id="i-prev" class="info" style="display:none">Previous post</span> <span id="i-next" class="info" style="display:none">Next post</span> <span id="i-top" class="info" style="display:none">Back to top</span> <span id="i-share" class="info" style="display:none">Share post</span></span><br><div id="share" style="display:none"><ul><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://hunter-gu.github.io/personal-blog/2019/04/15/json-schema/"><i class="fab fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https://hunter-gu.github.io/personal-blog/2019/04/15/json-schema/&text=实现一个 Vue json-form"><i class="fab fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://hunter-gu.github.io/personal-blog/2019/04/15/json-schema/&title=实现一个 Vue json-form"><i class="fab fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://hunter-gu.github.io/personal-blog/2019/04/15/json-schema/&is_video=false&description=实现一个 Vue json-form"><i class="fab fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=实现一个 Vue json-form&body=Check out this article: https://hunter-gu.github.io/personal-blog/2019/04/15/json-schema/"><i class="fas fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https://hunter-gu.github.io/personal-blog/2019/04/15/json-schema/&title=实现一个 Vue json-form"><i class="fab fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https://hunter-gu.github.io/personal-blog/2019/04/15/json-schema/&title=实现一个 Vue json-form"><i class="fab fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://hunter-gu.github.io/personal-blog/2019/04/15/json-schema/&title=实现一个 Vue json-form"><i class="fab fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https://hunter-gu.github.io/personal-blog/2019/04/15/json-schema/&title=实现一个 Vue json-form"><i class="fab fa-digg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.tumblr.com/share/link?url=https://hunter-gu.github.io/personal-blog/2019/04/15/json-schema/&name=实现一个 Vue json-form&description="><i class="fab fa-tumblr" aria-hidden="true"></i></a></li><li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https://hunter-gu.github.io/personal-blog/2019/04/15/json-schema/&t=实现一个 Vue json-form"><i class="fab fa-hacker-news" aria-hidden="true"></i></a></li></ul></div><div id="toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#分层"><span class="toc-number">1.</span> <span class="toc-text">分层</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-ElementUI"><span class="toc-number">2.</span> <span class="toc-text">使用 ElementUI</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Validator"><span class="toc-number">3.</span> <span class="toc-text">Validator</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nested"><span class="toc-number">4.</span> <span class="toc-text">Nested</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Custom-Component"><span class="toc-number">5.</span> <span class="toc-text">Custom Component</span></a></li></ol></div></span></div><div class="content index py4"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">实现一个 Vue json-form</h1><div class="meta"><span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Nail's Blog</span></span><div class="postdate"><time datetime="2019-04-15T13:06:53.000Z" itemprop="datePublished">2019-04-15</time></div><div class="article-category"><i class="fas fa-archive"></i> <a class="category-link" href="/personal-blog/categories/Frontend/">Frontend</a></div><div class="article-tag"><i class="fas fa-tag"></i> <a class="tag-link" href="/personal-blog/tags/vue/">vue</a></div></div></header><div class="content" itemprop="articleBody"><p>在开发管理系统时, 我们几乎一直在编写 <code>input</code>, <code>upload</code>, <code>select</code> 等表单组件, 虽然有 <code>ElementUI</code> 等组件库提供了方便, 但是仍旧需要编写模板, 然后就需要测试, 这是一个死循环。</p><p>但是这些表单组件实际上使用的逻辑和方法都很相似, 重复的编写和测试让人厌烦, 于是我就想能否将表单的结构通过 <code>json</code> 进行表示, 然后根据 <code>json</code> 结构渲染出组件树, 并且可以结合 <code>ElementUI</code> 这样看起来可以省不少事。</p><p>恰好之前看到一个叫作 <a href="https://github.com/mozilla-services/react-jsonschema-form" target="_blank" rel="noopener">react-jsonschema-form</a> 的组件, 是由 Mozilla 开源的 React 组件。 这个组件使用起来略微复杂, 所以我就大致看了一下它的结构, 借鉴了一些地方, 然后就开始设计 json-form 组件了。</p><h2 id="分层"><a href="#分层" class="headerlink" title="分层"></a>分层</h2><p>一般而言, 一个组件会含有 <code>props</code> 和向外 emit 的 <code>events</code>。 对于表单组件而言, <code>props</code> 和 <code>events</code> 的功能比较单一:</p><ul><li><code>props</code>: 对于表单组件而言, <code>props</code> 一般用于控制 UI 界面;</li><li><code>events</code>: 对于表单组件而言, <code>events</code> 一般用于表单的验证以及获取当前的值。</li></ul><p>因为 Vue 中提供了 <code>v-model</code> 这样的语法糖, 所以 <code>event</code> 的功能可以弱化, 最终将它抽象为一个 <code>value</code> 层即可。</p><p>最终通过两层结构 <code>props</code> 和 <code>value</code> 就可以大致描述一个表单组件; 加上用于描述组件树结构的 <code>json</code>, 所以 json-form 组件通过三层结构就可以描述一个结构化的表单:</p><ul><li>json-schema: 描述组件树的结构, 声明使用的组件;</li><li>ui-schema: 设置每个组件的 <code>props</code>;</li><li>value(v-model): 每个组件的 <code>value</code>。</li></ul><p>也就是说 json-schema 组件的 <code>props</code> 就是上面三项, 以及表单数据变化时向上 emit 的 <code>input</code> 事件。</p><h2 id="使用-ElementUI"><a href="#使用-ElementUI" class="headerlink" title="使用 ElementUI"></a>使用 ElementUI</h2><p>通过<a href="#分层">分层</a>步骤, 组件的大致设计其实已经完成了, 接下来本应该是开发表单组件以供在 json-schema 中使用。 但是社区已经有 ElementUI 这样优秀的组件库了, 我们不必自己去造这样的轮子。 利用 <code>Vue</code> 中的<a href="https://cn.vuejs.org/v2/guide/components.html#%E5%8A%A8%E6%80%81%E7%BB%84%E4%BB%B6" target="_blank" rel="noopener">动态组件</a>就可以实现这一功能, 代价就是需要将 ElementUI 中的表单组件都声明为全局组件, 还好这么做问题并不大而且也比较方便。</p><p>在 json-schema 中直接声明(ElementUI 中表单组件的)组件名就表示使用该组件, 比如声明 ElInput 最终就会在界面中展示一个输入框。</p><p>这么做的另一个好处是可以使用全局声明的自定义组件, 所以扩展性就比较好。</p><h2 id="Validator"><a href="#Validator" class="headerlink" title="Validator"></a><code>Validator</code></h2><p>表单组件总是需要 <code>validator</code> 的, 所以我们需要提供这样的功能。 将 <code>validator</code> 定义在 json-schema 中而不是 ui-schmea 中, 因为如果定义在 ui-schema 中, 就需要依赖于组件自身是否提供了 <code>validator</code> 这样的 <code>prop</code>, 在每次添加自定义组件时就很不方便。</p><p>通过在 json-form 组件内部拦截每个组件的 <code>input</code> 事件并调用 <code>validator</code> 就可以实现这样的功能。 并且还可以支持自定义 <code>errorMessage</code>。</p><h2 id="Nested"><a href="#Nested" class="headerlink" title="Nested"></a>Nested</h2><p>有时候你真的需要多层嵌套的表单结构, 可能是在区分各个模块的场景下, 要实现这样的功能也很简单, 利用 <code>Vue</code> 中的<a href="https://cn.vuejs.org/v2/guide/components-edge-cases.html#%E9%80%92%E5%BD%92%E7%BB%84%E4%BB%B6" target="_blank" rel="noopener">递归组件</a>就可以实现这样的功能。</p><h2 id="Custom-Component"><a href="#Custom-Component" class="headerlink" title="Custom Component"></a>Custom Component</h2><p>前面提过 json-schema 的设计使得使用自定义组件成为可能, 但是自定义组件也需要满足一些条件才可以很方便的使用:</p><ul><li>自定义组件必须提供 <code>value</code> props, 以表示组件的值;</li><li>必须 emit <code>input</code> 事件, 因为最终的值会通过 <code>value</code> + <code>input</code> 一层层向上派发, 并且在对值进行验证时, 也需要用到这一事件;</li><li>通过 emit <code>blur</code> 事件, 触发对值的 <code>required</code> 进行验证。</li></ul><p>具体的<a href="https://github.com/Hunter-Gu/json-form" target="_blank" rel="noopener">代码实现</a>详见 github 仓库。</p></div></article><div id="footer-post-container"><div id="footer-post"><div id="nav-footer" style="display:none"><ul><li><a href="/personal-blog/">Home</a></li><li><a href="/personal-blog/archives/">Writing</a></li><li><a href="/personal-blog/about/">About</a></li><li><a href="/personal-blog/tags/">Tag</a></li><li><a href="/personal-blog/categories/">categories</a></li><li><a href="/personal-blog/inspiration/">inspiration</a></li></ul></div><div id="toc-footer" style="display:none"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#分层"><span class="toc-number">1.</span> <span class="toc-text">分层</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-ElementUI"><span class="toc-number">2.</span> <span class="toc-text">使用 ElementUI</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Validator"><span class="toc-number">3.</span> <span class="toc-text">Validator</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nested"><span class="toc-number">4.</span> <span class="toc-text">Nested</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Custom-Component"><span class="toc-number">5.</span> <span class="toc-text">Custom Component</span></a></li></ol></div><div id="share-footer" style="display:none"><ul><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://hunter-gu.github.io/personal-blog/2019/04/15/json-schema/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https://hunter-gu.github.io/personal-blog/2019/04/15/json-schema/&text=实现一个 Vue json-form"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://hunter-gu.github.io/personal-blog/2019/04/15/json-schema/&title=实现一个 Vue json-form"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://hunter-gu.github.io/personal-blog/2019/04/15/json-schema/&is_video=false&description=实现一个 Vue json-form"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=实现一个 Vue json-form&body=Check out this article: https://hunter-gu.github.io/personal-blog/2019/04/15/json-schema/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https://hunter-gu.github.io/personal-blog/2019/04/15/json-schema/&title=实现一个 Vue json-form"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https://hunter-gu.github.io/personal-blog/2019/04/15/json-schema/&title=实现一个 Vue json-form"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://hunter-gu.github.io/personal-blog/2019/04/15/json-schema/&title=实现一个 Vue json-form"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https://hunter-gu.github.io/personal-blog/2019/04/15/json-schema/&title=实现一个 Vue json-form"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.tumblr.com/share/link?url=https://hunter-gu.github.io/personal-blog/2019/04/15/json-schema/&name=实现一个 Vue json-form&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https://hunter-gu.github.io/personal-blog/2019/04/15/json-schema/&t=实现一个 Vue json-form"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li></ul></div><div id="actions-footer"><a id="menu" class="icon" href="#" onclick='return $("#nav-footer").toggle(),!1'><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a> <a id="toc" class="icon" href="#" onclick='return $("#toc-footer").toggle(),!1'><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a> <a id="share" class="icon" href="#" onclick='return $("#share-footer").toggle(),!1'><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a> <a id="top" style="display:none" class="icon" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")'><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></div></div></div><footer id="footer"><div class="footer-left">Copyright &copy; 2016-2023 Nail Hunter</div><div class="footer-right"><nav><ul><li><a href="/personal-blog/">Home</a></li><li><a href="/personal-blog/archives/">Writing</a></li><li><a href="/personal-blog/about/">About</a></li><li><a href="/personal-blog/tags/">Tag</a></li><li><a href="/personal-blog/categories/">categories</a></li><li><a href="/personal-blog/inspiration/">inspiration</a></li></ul></nav></div></footer></div><link rel="stylesheet" href="/personal-blog/lib/font-awesome/css/all.min.css"><link rel="stylesheet" href="/personal-blog/lib/justified-gallery/css/justifiedGallery.min.css"><script src="/personal-blog/lib/jquery/jquery.min.js"></script><script src="/personal-blog/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script><script src="/personal-blog/lib/clipboard/clipboard.min.js"></script><script type="text/javascript">$(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })</script><script src="/personal-blog/js/main.js"></script><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?d74a499667241a64116720b82963068b";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script src="https://unpkg.com/mermaid@8.4.8/dist/mermaid.min.js"></script><script>window.mermaid&&mermaid.initialize({theme:"forest"})</script></body></html><!-- rebuild by neat -->